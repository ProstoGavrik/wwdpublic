on:
  workflow_dispatch:
  push:
    branches: [ master, main ]
    paths:
      - 'RobustToolbox/'
      - '.github/workflows/update-wiki-json.yml'
      - 'Content.Server/GuideGenerator/**.cs'
      - 'Content.Shared/Chemistry/**.cs'
      - 'Content.Server/Chemistry/**.cs'
      - 'Content.Server/_White/GuideGenerator/**.cs'
      - 'Content.Server/Research/Systems/**.cs'
      - 'Content.Shared/Research/Prototypes'
      - 'Resources/Prototypes/Research/**.yml'

jobs:
  update-wiki:
    name: Build and Publish JSON blobs to wiki
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Master
      uses: actions/checkout@v3

    - name: Checkout target repo
      uses: actions/checkout@v3
      with:
        repository: ProstoGavrik/wiki_json_prototypes
        path: target-repo
        ssh-key: ${{ secrets.TARGET_REPO_TOKEN }}
          
    - name: Commit and push changes
      working-directory: target-repo
      run: |
        copy .github/workflows/update-wiki-json.yml target-repo/
        cd target-repo
        git add .
        git commit -m "Update json files"
        git push
